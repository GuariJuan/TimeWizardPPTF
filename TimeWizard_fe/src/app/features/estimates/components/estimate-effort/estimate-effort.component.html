<!-- Mostrar formulario si no existe una predicci贸n -->
<div class="container" *ngIf="!prediction">
    <div class="card shadow-sm py-4 px-5">
        <h3 class="fw-bold border-bottom pb-2 mb-4"> Nueva estimaci贸n individual</h3>

        <form class="w-100 " [formGroup]="calculateEffortForm" (ngSubmit)="calculateEffort()">
            <p class="h4 text-center mb-4">Ingresa los siguientes datos:</p>

            <!-- EXPERIENCIA DEL EQUIPO FRONTEND -->
            <div class="d-flex justify-content-between align-items-center my-2">
                <label for="frontend" class="form-label col-4">Experiencia del equipo frontend:</label>
                <div class="col-6">
                    <select class="form-select" formControlName="seniorityFrontend">
                        <option value="" disabled selected hidden>Selecciona una opci贸n</option>
                        <option *ngFor="let exp of seniorities" [value]="exp.id">{{ exp.seniority }}</option>
                    </select>
                    <small
                        *ngIf="calculateEffortForm.get('seniorityFrontend')?.touched && calculateEffortForm.get('seniorityFrontend')?.errors?.['required']"
                        class="text-danger">* Este campo es obligatorio.</small>
                </div>
            </div>

            <!-- EXPERIENCIA DEL EQUIPO BACKEND -->
            <div class="d-flex justify-content-between align-items-center my-2">
                <label for="backend" class="form-label col-4">Experiencia del equipo backend:</label>
                <div class="col-6">
                    <select class="form-select" formControlName="seniorityBackend">
                        <option value="" disabled selected hidden>Selecciona una opci贸n</option>
                        <option *ngFor="let exp of seniorities" [value]="exp.id">{{ exp.seniority }}</option>
                    </select>
                    <small
                        *ngIf="calculateEffortForm.get('seniorityBackend')?.touched && calculateEffortForm.get('seniorityBackend')?.errors?.['required']"
                        class="text-danger">* Este campo es obligatorio.</small>
                </div>
            </div>

            <!-- LENGUAJE FRONTEND -->
            <div class="d-flex justify-content-between align-items-center my-2">
                <label for="frontendLanguage" class="form-label col-4">Lenguaje a utilizar para el frontend:</label>
                <div class="col-6">
                    <select class="form-select" formControlName="frontendLanguage">
                        <option value="" disabled selected hidden>Selecciona una opci贸n</option>
                        <option *ngFor="let language of frontendLanguage" [value]="language.language">{{
                            language.language }}</option>
                    </select>
                    <small
                        *ngIf="calculateEffortForm.get('frontendLanguage')?.touched && calculateEffortForm.get('frontendLanguage')?.errors?.['required']"
                        class="text-danger">* Este campo es obligatorio.</small>
                </div>
            </div>

            <!-- LENGUAJE BACKEND -->
            <div class="d-flex justify-content-between align-items-center my-2">
                <label for="backendLanguage" class="form-label col-4">Lenguaje a utilizar para el backend:</label>
                <div class="col-6">
                    <select class="form-select" formControlName="backendLanguage">
                        <option value="" disabled selected hidden>Selecciona una opci贸n</option>
                        <option *ngFor="let language of backendLanguage" [value]="language.language">{{
                            language.language }}</option>
                    </select>
                    <small
                        *ngIf="calculateEffortForm.get('backendLanguage')?.touched && calculateEffortForm.get('backendLanguage')?.errors?.['required']"
                        class="text-danger">* Este campo es obligatorio.</small>
                </div>
            </div>

            <!-- COMPLEJIDAD -->
            <div class="d-flex justify-content-between align-items-center my-2">
                <label for="complexity" class="form-label col-4">Complejidad:</label>
                <div class="col-6">
                    <input type="number" id="complexity" class="form-control" formControlName="complexity" min="1"
                        max="32">
                    <small
                        *ngIf="calculateEffortForm.get('complexity')?.invalid && calculateEffortForm.get('complexity')?.touched"
                        class="text-danger">
                        * El valor debe estar entre 1 y 32.
                    </small>
                </div>
            </div>

            <!-- SELECCIN DE MODELO -->
            <div class="d-flex justify-content-between align-items-center ">
                <label class="form-label col-4">Selecciona un modelo:</label>
                <div class="col-6 border p-3 rounded">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" id="option1" [(ngModel)]="selectedOption" value="1"
                            name="option" [ngModelOptions]="{standalone: true}">
                        <label class="form-check-label" for="option1">Regresi贸n Lineal M煤ltiple</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" id="option2" [(ngModel)]="selectedOption" value="2"
                            name="option" [ngModelOptions]="{standalone: true}">
                        <label class="form-check-label" for="option2">XGBoost</label>
                    </div>
                    <small *ngIf="showMessageToSelectModel" class="text-danger">* Selecciona el modelo a
                        utilizar.</small>
                </div>
            </div>

            <!-- Botones -->
            <div class="d-flex justify-content-between mt-5 mb-3">
                <button class="btn btn-secondary" type="button" routerLink="/home/estimates"
                    (click)="resetForm()">Volver</button>
                <button class="btn btn-primary" [disabled]="calculateEffortForm.invalid" type="submit">Estimar</button>
            </div>
        </form>
    </div>
</div>

<!-- Mostrar los datos de la predicci贸n si ya existe una -->
<div class="container my-4" *ngIf="prediction">
    <div class="card shadow-sm p-4">
        <h3 class="fw-bold border-bottom pb-2"> Estimaci贸n Calculada</h3>

        <div class="mt-3">
            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                <span class="fw-semibold">
                    <i class="bi bi-pencil-square me-2"></i> Dise帽o:
                </span>
                <span>{{ prediction.t_design | number: '1.2-2'}} horas</span>
            </div>

            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                <span class="fw-semibold">
                    <i class="bi bi-code me-2"></i> Frontend:
                </span>
                <span>{{ prediction.t_frontend | number: '1.2-2'}} horas</span>
            </div>

            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                <span class="fw-semibold">
                    <i class="bi bi-database me-2"></i> Backend:
                </span>
                <span>{{ prediction.t_backend | number: '1.2-2'}} horas</span>
            </div>

            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                <span class="fw-semibold">
                    <i class="bi bi-check2-circle me-2"></i> QA:
                </span>
                <span>{{ prediction.t_qa | number: '1.2-2'}} horas</span>
            </div>

            <div class="d-flex justify-content-between align-items-center py-2">
                <span class="fw-semibold">
                    <i class="bi bi-calculator me-2"></i> TOTAL:
                </span>
                <span>{{ prediction.t_qa+prediction.t_design+prediction.t_frontend+prediction.t_backend | number: '1.2-2'}} horas</span>
            </div>
        </div>

        <!-- Gr谩fico centrado -->
        <div class="d-flex justify-content-center mt-4">
            <div class="w-50">
                <p-chart type="bar" [data]="data" [options]="options"></p-chart>
            </div>
        </div>


        <!-- Bot贸n Volver -->
        <div class="d-flex justify-content-start mt-4">
            <button class="btn btn-secondary" (click)="resetPrediction()">
                <i class="bi bi-arrow-left me-2"></i> Volver
            </button>
        </div>
    </div>

</div>

<app-spinner [isLoading]="isLoading"></app-spinner>